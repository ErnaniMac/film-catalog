# Cursor Rules - Film Catalog Project

## Vis√£o Geral do Projeto

Este √© um projeto full-stack com:
- **Backend**: Laravel (PHP 7.4+) em `/backend`
- **Frontend**: Vue 3 + Vite em `/frontend`
- **Arquitetura**: Monorepo com backend e frontend separados no mesmo reposit√≥rio Git
- **Comunica√ß√£o**: API REST entre frontend e backend
- **Containeriza√ß√£o**: Docker Compose para desenvolvimento

---

## Estrutura do Projeto

```
film-catalog/
‚îú‚îÄ‚îÄ backend/          # Aplica√ß√£o Laravel
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ frontend/         # Aplica√ß√£o Vue 3 SPA
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

**IMPORTANTE**: Sempre respeite a separa√ß√£o entre `/backend` e `/frontend`. Nunca misture c√≥digo PHP com c√≥digo JavaScript/Vue.

---

## Backend - Laravel

### Vers√£o e Requisitos
- PHP 7.4 ou superior
- Laravel 8.x ou superior
- MySQL para banco de dados
- Redis para cache/sess√µes (opcional)

### Pacotes Principais
- `laravel/sanctum` - Autentica√ß√£o API
- `spatie/laravel-permission` - Roles e permiss√µes
- `predis/predis` - Cliente Redis

### Conven√ß√µes de C√≥digo

#### Controllers
- Use **Resource Controllers** quando apropriado
- Sempre use **FormRequest** para valida√ß√£o (n√£o valide diretamente no controller)
- Retorne respostas JSON consistentes:
  ```php
  return response()->json(['data' => $resource], 200);
  return response()->json(['message' => 'Success'], 201);
  return response()->json(['error' => 'Message'], 400);
  ```
- Use **type-hinting** para todos os par√¢metros e retornos
- Inje√ß√£o de depend√™ncia via construtor quando poss√≠vel

#### Models
- Use **Eloquent Relationships** apropriadas (hasMany, belongsTo, etc.)
- Implemente traits do Spatie Permission: `use HasRoles;`
- Defina `$fillable` ou `$guarded` explicitamente
- Use **Accessors/Mutators** quando necess√°rio
- Sempre defina `$casts` para tipos de dados

#### Migrations
- Nomes descritivos: `create_favorites_table`, `add_role_id_to_users_table`
- Use `timestamps()` quando apropriado
- Defina √≠ndices para campos de busca frequente
- Use `foreignId()` para relacionamentos

#### Routes
- Todas as rotas da API em `routes/api.php`
- Use **Route Groups** com middleware:
  ```php
  Route::middleware('auth:sanctum')->group(function () {
      // rotas protegidas
  });
  ```
- Use **Resource Routes** quando aplic√°vel:
  ```php
  Route::apiResource('users', UserController::class);
  ```

#### Form Requests
- Crie FormRequests para valida√ß√£o complexa
- Retorne mensagens de erro em portugu√™s quando apropriado
- Use regras de valida√ß√£o do Laravel

#### Services
- Use **Service Classes** para l√≥gica de neg√≥cio complexa
- Mantenha controllers leves, delegue l√≥gica para services
- Exemplo: `TmdbService` para integra√ß√£o com TMDB API

#### Exceptions
- Use **Custom Exceptions** quando apropriado
- Sempre retorne erros em formato JSON consistente

### Autentica√ß√£o
- Use **Laravel Sanctum** para autentica√ß√£o API
- Tokens devem ser enviados via header: `Authorization: Bearer {token}`
- Implemente refresh token se necess√°rio
- Proteja rotas com middleware `auth:sanctum`

### Roles e Permiss√µes
- Use **Spatie Laravel Permission**
- Defina roles e permiss√µes via seeders
- Use middleware `role:` ou `permission:` nas rotas
- Exemplo: `Route::middleware(['auth:sanctum', 'role:admin'])->group(...)`

### Testes
- Use **PHPUnit** para testes unit√°rios e de integra√ß√£o
- Teste controllers, models, services e features
- Use **Factories** para criar dados de teste
- Mantenha cobertura de c√≥digo alta (>80%)

### API Responses
- Sempre retorne JSON
- Use status codes HTTP apropriados:
  - `200` - Sucesso (GET, PUT, PATCH)
  - `201` - Criado (POST)
  - `204` - Sem conte√∫do (DELETE)
  - `400` - Requisi√ß√£o inv√°lida
  - `401` - N√£o autenticado
  - `403` - N√£o autorizado
  - `404` - N√£o encontrado
  - `422` - Erro de valida√ß√£o
  - `500` - Erro interno

### Integra√ß√£o TMDB
- Use **HTTP Client** do Laravel para chamadas √† API TMDB
- Armazene API key em `.env` como `TMDB_API_KEY`
- Implemente cache para reduzir chamadas √† API externa
- Trate erros de API externa adequadamente

---

## Frontend - Vue 3

### Stack Tecnol√≥gica
- **Vue 3** com Composition API
- **Vite** como build tool
- **Pinia** para gerenciamento de estado
- **Vue Router** para roteamento
- **Axios** para requisi√ß√µes HTTP
- **PrimeVue** para componentes UI
- **vee-validate** + **yup** para valida√ß√£o
- **dayjs** para manipula√ß√£o de datas
- **lodash** para utilit√°rios

### Conven√ß√µes de C√≥digo

#### Estrutura de Componentes
- Use **Composition API** com `<script setup>`
- Organize componentes por feature:
  ```
  src/
  ‚îú‚îÄ‚îÄ components/
  ‚îÇ   ‚îú‚îÄ‚îÄ common/        # Componentes reutiliz√°veis
  ‚îÇ   ‚îú‚îÄ‚îÄ films/         # Componentes de filmes
  ‚îÇ   ‚îú‚îÄ‚îÄ favorites/     # Componentes de favoritos
  ‚îÇ   ‚îî‚îÄ‚îÄ admin/         # Componentes admin
  ‚îú‚îÄ‚îÄ views/
  ‚îú‚îÄ‚îÄ stores/            # Pinia stores
  ‚îú‚îÄ‚îÄ composables/       # Composables reutiliz√°veis
  ‚îî‚îÄ‚îÄ utils/
  ```

#### Componentes
- Use **Single File Components** (.vue)
- Nomes de componentes em **PascalCase**
- Props com type definition e valida√ß√£o
- Emit events com nomes descritivos
- Use `<script setup>` sempre que poss√≠vel

#### Composables
- Crie composables para l√≥gica reutiliz√°vel
- Exemplo: `useAuth.js`, `useApi.js`, `useTmdb.js`
- Retorne objetos reativos quando necess√°rio

#### Pinia Stores
- Organize stores por dom√≠nio: `authStore`, `filmStore`, `favoriteStore`
- Use **Actions** para opera√ß√µes ass√≠ncronas
- Use **Getters** para dados computados
- Mantenha stores focadas e pequenas

#### Vue Router
- Use **lazy loading** para rotas:
  ```js
  {
    path: '/admin',
    component: () => import('@/views/Admin.vue')
  }
  ```
- Implemente **route guards** para autentica√ß√£o
- Use **meta fields** para permiss√µes

#### Requisi√ß√µes HTTP
- Configure **Axios** com base URL da API Laravel
- Use **interceptors** para:
  - Adicionar token de autentica√ß√£o
  - Tratar erros globalmente
  - Mostrar loading states
- Centralize chamadas de API em services/composables

#### Valida√ß√£o de Formul√°rios
- Use **vee-validate** com **yup** schemas
- Valide no frontend, mas sempre confie na valida√ß√£o do backend
- Mostre mensagens de erro claras e em portugu√™s

#### UI Components (PrimeVue)
- Use componentes do PrimeVue consistentemente
- Customize temas quando necess√°rio
- Mantenha design system consistente

#### Estado Global
- Use **Pinia** para estado compartilhado
- Evite prop drilling excessivo
- Use `provide/inject` para casos espec√≠ficos

### Autentica√ß√£o Frontend
- Armazene token em **localStorage** ou **cookie** (preferir httpOnly cookie se poss√≠vel)
- Implemente **refresh token** logic
- Redirecione para login quando token expirar
- Use composable `useAuth` para l√≥gica de autentica√ß√£o

### Tratamento de Erros
- Capture erros de API globalmente
- Mostre mensagens de erro amig√°veis ao usu√°rio
- Use toast notifications (PrimeVue Toast) para feedback
- Log erros para debugging em desenvolvimento

### Performance
- Use **lazy loading** para rotas e componentes grandes
- Implemente **code splitting** com Vite
- Use **v-memo** para listas grandes quando apropriado
- Otimize imagens e assets

---

## Docker

### Estrutura
- Use `docker-compose.yml` na raiz do projeto
- Separe servi√ßos: `laravel`, `mysql`, `node` (para frontend)
- Configure volumes para persist√™ncia
- Use `.env` para configura√ß√µes

### Boas Pr√°ticas
- N√£o commite `.env` files
- Use `.env.example` como template
- Configure networks apropriadamente
- Exponha apenas portas necess√°rias

---

## Conven√ß√µes de Commits

Use **Conventional Commits**:

- `feat:` - Nova funcionalidade
- `fix:` - Corre√ß√£o de bug
- `docs:` - Documenta√ß√£o
- `style:` - Formata√ß√£o, ponto e v√≠rgula faltando, etc.
- `refactor:` - Refatora√ß√£o de c√≥digo
- `test:` - Adicionar ou corrigir testes
- `chore:` - Tarefas de build, configura√ß√£o, etc.

### Regras de Mensagens de Commit

- **OBRIGAT√ìRIO: M√°ximo de 120 caracteres** na linha principal (subject)
- **SEMPRE verifique o tamanho antes de fazer commit**
- Use o modo imperativo ("adiciona" n√£o "adicionando" ou "adicionado")
- Primeira linha deve ser clara e descritiva
- Se necess√°rio, adicione corpo do commit ap√≥s linha em branco para detalhes
- **NUNCA ultrapasse 120 caracteres na primeira linha do commit**

Exemplos:
```
feat: adiciona busca de filmes na API TMDB
fix: corrige valida√ß√£o de email no cadastro
docs: atualiza README com instru√ß√µes Docker
refactor: reorganiza estrutura de stores Pinia
test: adiciona testes para FavoriteController
```

**Exemplos de mensagens muito longas (evitar):**
```
‚ùå feat: adiciona funcionalidade completa de busca de filmes na API TMDB com cache e tratamento de erros
‚úÖ feat: adiciona busca de filmes na API TMDB

Corpo do commit (opcional):
- Implementa cache para reduzir chamadas √† API
- Adiciona tratamento de erros
- Melhora performance da busca
```

---

## Boas Pr√°ticas Gerais

### C√≥digo
- **Sempre** escreva c√≥digo limpo e leg√≠vel
- Use nomes descritivos para vari√°veis, fun√ß√µes e classes
- Comente c√≥digo complexo, mas evite coment√°rios √≥bvios
- Mantenha fun√ß√µes/m√©todos pequenos e focados
- Evite c√≥digo duplicado (DRY - Don't Repeat Yourself)
- Use **SOLID principles** quando apropriado

### Seguran√ßa
- **Nunca** commite credenciais ou API keys
- Use `.env` para configura√ß√µes sens√≠veis
- Valide e sanitize todas as entradas do usu√°rio
- Use prepared statements (Eloquent j√° faz isso)
- Implemente rate limiting quando necess√°rio
- Use HTTPS em produ√ß√£o

### Performance
- Use cache quando apropriado (Redis, Laravel Cache)
- Otimize queries do banco (use Eager Loading)
- Implemente pagina√ß√£o para listas grandes
- Use lazy loading no frontend
- Minifique assets em produ√ß√£o

### Documenta√ß√£o
- Mantenha README.md atualizado
- Documente APIs complexas
- Use PHPDoc para m√©todos p√∫blicos
- Comente decis√µes arquiteturais importantes

### Git
- Fa√ßa commits frequentes e at√¥micos
- Use branches para features (`feature/nome-feature`)
- Escreva mensagens de commit claras
- Nunca commite arquivos gerados ou tempor√°rios

---

## Regras Espec√≠ficas

### Ao Criar Novos Arquivos
1. **Backend**: Sempre crie testes correspondentes
2. **Frontend**: Mantenha componentes pequenos e focados
3. **Ambos**: Siga a estrutura de pastas estabelecida

### Ao Modificar C√≥digo Existente
1. Mantenha compatibilidade com c√≥digo existente
2. Atualize testes se necess√°rio
3. Verifique se n√£o quebrou funcionalidades relacionadas

### Ao Trabalhar com API
1. Sempre valide dados no backend
2. Trate erros adequadamente no frontend
3. Use status codes HTTP corretos
4. Documente endpoints novos

### Ao Trabalhar com Banco de Dados
1. Use migrations para todas as mudan√ßas de schema
2. Crie seeders para dados iniciais
3. Use factories para testes
4. Nunca modifique migrations j√° commitadas (crie novas)

---

## Comandos √öteis

### Backend (Laravel)
```bash
php artisan migrate
php artisan migrate:fresh --seed
php artisan test
php artisan make:controller ControllerName
php artisan make:model ModelName -m
php artisan make:request RequestName
```

### Frontend (Vue)
```bash
npm run dev          # Desenvolvimento
npm run build        # Build produ√ß√£o
npm run test         # Testes
```

### Docker
```bash
docker-compose up -d
docker-compose down
docker-compose exec laravel php artisan migrate
```

---

## Checklist Antes de Commitar

- [ ] C√≥digo segue as conven√ß√µes estabelecidas
- [ ] Testes passam (backend e frontend)
- [ ] N√£o h√° console.log ou var_dump esquecidos
- [ ] Vari√°veis de ambiente n√£o foram commitadas
- [ ] Mensagem de commit segue o padr√£o Conventional Commits
- [ ] **Mensagem de commit tem no m√°ximo 120 caracteres (VERIFICAR SEMPRE)**
- [ ] Documenta√ß√£o atualizada se necess√°rio
- [ ] C√≥digo foi revisado

---

## Notas Finais

- **Sempre** priorize c√≥digo limpo e manuten√≠vel
- **Sempre** escreva testes para funcionalidades cr√≠ticas
- **Sempre** valide dados no backend
- **Nunca** confie apenas na valida√ß√£o do frontend
- **Sempre** trate erros adequadamente
- **Sempre** documente decis√µes importantes
- **SEMPRE** respeite o limite de 120 caracteres nas mensagens de commit

## ‚ö†Ô∏è REGRA CR√çTICA: Mensagens de Commit

**NUNCA fa√ßa commit com mensagem que ultrapasse 120 caracteres na primeira linha.**

Antes de executar `git commit`, verifique o tamanho da mensagem. Se ultrapassar 120 caracteres:
1. Encurte a primeira linha (m√°ximo 120 caracteres)
2. Use o corpo do commit (ap√≥s linha em branco) para detalhes
3. Exemplo: `git commit -m "fix: corrige permiss√µes" -m "Detalhes adicionais aqui..."`

**Exemplo de como encurtar:**
```
‚ùå fix: corrige problema de permiss√µes no frontend que estava impedindo o Vite de criar arquivos tempor√°rios

‚úÖ fix: corrige permiss√µes do frontend para Vite criar arquivos tempor√°rios
```

---

## üö´ REGRA DE COMMITS AUTOM√ÅTICOS

**NUNCA fa√ßa commits automaticamente.**

**IMPORTANTE**: O agente N√ÉO deve fazer commits Git automaticamente ap√≥s fazer altera√ß√µes nos arquivos.

### Regras de Commit:

1. **NUNCA execute `git commit` automaticamente**
2. **NUNCA execute `git add` seguido de `git commit` sem solicita√ß√£o expl√≠cita**
3. **Apenas fa√ßa commit quando o usu√°rio digitar explicitamente: `<commit now>`**
4. **Quando o usu√°rio solicitar commit com `<commit now>`, ent√£o:**
   - Execute `git add -A` para adicionar todas as altera√ß√µes
   - Execute `git commit` com mensagem seguindo Conventional Commits
   - **SEMPRE respeite o limite de 120 caracteres na mensagem**
   - Use mensagens descritivas e claras

### Comportamento Esperado:

- ‚úÖ Fazer altera√ß√µes nos arquivos quando solicitado
- ‚úÖ Preparar mensagens de commit quando solicitado
- ‚ùå **N√ÉO fazer commit automaticamente ap√≥s altera√ß√µes**
- ‚úÖ Fazer commit **APENAS** quando o usu√°rio digitar `<commit now>`

### Exemplo de Uso:

**Usu√°rio**: "Corrija o bug no componente X"
**Agente**: Faz as corre√ß√µes, mas **N√ÉO** faz commit

**Usu√°rio**: "<commit now>"
**Agente**: Executa `git add -A && git commit -m "fix: corrige bug no componente X"`

---

Este arquivo deve ser atualizado conforme o projeto evolui e novas conven√ß√µes s√£o estabelecidas.

